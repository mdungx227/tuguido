<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tá»§ gá»­i Ä‘á»“ thÃ´ng minh IoT</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #74ebd5, #ACB6E5);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding: 0;
    }

    .container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      padding: 30px 40px;
      width: 360px;
      text-align: center;
      transition: 0.3s;
      animation: fadeIn 0.6s ease;
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
    }

    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      width: 95%;
      padding: 10px;
      margin-top: 10px;
      background-color: #2196F3;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      font-size: 1em;
    }

    button:hover { opacity: 0.9; }

    .link {
      margin-top: 15px;
      cursor: pointer;
      color: #333;
      text-decoration: underline;
      font-size: 0.9em;
    }

    .hidden { display: none; }
  </style>
</head>
<body>

  <!-- ÄÄƒng nháº­p -->
  <div id="loginPage" class="container">
    <h1>ÄÄƒng nháº­p há»‡ thá»‘ng</h1>
    <input type="text" id="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
    <input type="password" id="password" placeholder="Máº­t kháº©u">
    <button onclick="login()">ÄÄƒng nháº­p</button>

    <div class="link" onclick="showRegister()">ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½</div>
  </div>

  <!-- ÄÄƒng kÃ½ -->
  <div id="registerPage" class="container hidden">
    <h1>ÄÄƒng kÃ½ tÃ i khoáº£n</h1>
    <input type="text" id="regName" placeholder="Há» vÃ  tÃªn">
    <input type="text" id="regPhone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
    <input type="password" id="regPass" placeholder="Máº­t kháº©u">
    <button onclick="register()">Táº¡o tÃ i khoáº£n</button>

    <div class="link" onclick="showLogin()">ÄÃ£ cÃ³ tÃ i khoáº£n? ÄÄƒng nháº­p</div>
  </div>

  <!-- Giao diá»‡n tá»§ gá»­i Ä‘á»“ -->
  <div id="mainPage" class="hidden">
    <h1>ğŸ”’ Tá»§ gá»­i Ä‘á»“ thÃ´ng minh IoT</h1>
    <p id="welcomeUser" style="font-weight:bold;"></p>

    <div class="lockers">
      <div class="locker" id="locker1">
        <h3>Tá»§ 1</h3>
        <div class="status free" id="status1">Trá»‘ng</div>
        <button onclick="sendItem(1)">Gá»­i Ä‘á»“</button>
        <button onclick="getItem(1)">Nháº­n Ä‘á»“</button>
      </div>

      <div class="locker" id="locker2">
        <h3>Tá»§ 2</h3>
        <div class="status free" id="status2">Trá»‘ng</div>
        <button onclick="sendItem(2)">Gá»­i Ä‘á»“</button>
        <button onclick="getItem(2)">Nháº­n Ä‘á»“</button>
      </div>
    </div>

    <h2>ğŸ“œ Lá»‹ch sá»­ gá»­i / nháº­n</h2>
    <table id="historyTable">
      <thead>
        <tr>
          <th>Thá»i gian</th>
          <th>Tá»§</th>
          <th>HÃ nh Ä‘á»™ng</th>
          <th>NgÆ°á»i dÃ¹ng</th>
        </tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>

    <button class="logout-btn" style="background:#f44336;margin-top:20px;" onclick="logout()">ÄÄƒng xuáº¥t</button>
  </div>

  <script>
    // Danh sÃ¡ch ngÆ°á»i dÃ¹ng
    const users = [
      { phone: "0987654321", password: "1234", name: "Nguyá»…n VÄƒn A" },
      { phone: "0911222333", password: "abcd", name: "Tráº§n Thá»‹ B" },
      { phone: "1", password: "1", name: "Test" }
    ];

    let currentUser = null;
    const lockerStatus = {1: "free", 2: "free"};
    const historyTable = document.getElementById("historyBody");

    /* ==== CHUYá»‚N TRANG ==== */
    function showRegister() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.remove("hidden");
    }

    function showLogin() {
      document.getElementById("registerPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
    }

    /* ==== ÄÄ‚NG KÃ ==== */
    function register() {
      const name = document.getElementById("regName").value.trim();
      const phone = document.getElementById("regPhone").value.trim();
      const pass = document.getElementById("regPass").value.trim();

      if (!name || !phone || !pass) {
        alert("âš  Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!");
        return;
      }

      if (users.some(u => u.phone === phone)) {
        alert("âŒ Sá»‘ Ä‘iá»‡n thoáº¡i Ä‘Ã£ tá»“n táº¡i!");
        return;
      }

      users.push({ phone, password: pass, name });

      alert("âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y Ä‘Äƒng nháº­p.");
      showLogin();
    }

    /* ==== ÄÄ‚NG NHáº¬P ==== */
    function login() {
      const phone = document.getElementById("phone").value.trim();
      const pass = document.getElementById("password").value.trim();

      const user = users.find(u => u.phone === phone && u.password === pass);
      if (!user) {
        alert("âŒ Sai sá»‘ Ä‘iá»‡n thoáº¡i hoáº·c máº­t kháº©u!");
        return;
      }

      currentUser = user;
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.add("hidden");
      document.getElementById("mainPage").classList.remove("hidden");

      document.getElementById("welcomeUser").textContent = `Xin chÃ o, ${user.name} (${user.phone})`;
    }

    /* ==== ÄÄ‚NG XUáº¤T ==== */
    function logout() {
      currentUser = null;
      document.getElementById("mainPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
    }

    /* ==== Tá»¦ Gá»¬I Äá»’ ==== */
    function updateStatus(id, state) {
      const s = document.getElementById("status" + id);
      s.className = "status " + state;
      s.textContent = state === "free" ? "Trá»‘ng" : "Äang dÃ¹ng";
    }

    function addHistory(lockerId, action) {
      const time = new Date().toLocaleString("vi-VN", { hour12: false });
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${time}</td>
        <td>Tá»§ ${lockerId}</td>
        <td>${action}</td>
        <td>${currentUser.name}</td>`;
      historyTable.prepend(row);
    }

    function sendItem(id) {
      if (lockerStatus[id] === "busy") {
        alert(`âŒ Tá»§ ${id} Ä‘Ã£ cÃ³ Ä‘á»“!`);
        return;
      }
      lockerStatus[id] = "busy";
      updateStatus(id, "busy");
      addHistory(id, "Gá»­i Ä‘á»“");
      alert(`âœ… Tá»§ ${id} Ä‘Ã£ má»Ÿ sáºµn Ä‘á»ƒ gá»­i Ä‘á»“.`);
    }

    function getItem(id) {
      if (lockerStatus[id] === "free") {
        alert(`âŒ Tá»§ ${id} Ä‘ang trá»‘ng!`);
        return;
      }
      lockerStatus[id] = "free";
      updateStatus(id, "free");
      addHistory(id, "Nháº­n Ä‘á»“");
      alert(`ğŸ“¦ Báº¡n Ä‘Ã£ nháº­n Ä‘á»“ tá»« tá»§ ${id}.`);
    }
  </script>

</body>
</html>
